/* LÃ“GICO_DEVDEN: */

DROP DATABASE IF EXISTS DEVDEN;

CREATE DATABASE DEVDEN;

USE DEVDEN;

CREATE TABLE USUARIOS (
    USR_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    USR_USERNAME VARCHAR(100) NOT NULL,
    USR_SENHA VARCHAR(100) NOT NULL,
    USR_EMAIL VARCHAR(100) NOT NULL,
    USR_NOME_COMPLETO VARCHAR(100) NOT NULL,
    USR_STAFF BOOL NOT NULL
);

CREATE TABLE TOPICOS (
    TOP_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    TOP_TITULO VARCHAR(100) NOT NULL,
    TOP_MENSAGEM VARCHAR(500) NOT NULL,
    FK_USUARIOS_USR_ID INTEGER
);

CREATE TABLE TAGS (
    TAG_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    TAG_NOME VARCHAR(100) NOT NULL,
    FK_USUARIOS_USR_ID INTEGER
);

CREATE TABLE POSTS (
    POS_MENSAGEM TEXT NOT NULL,
    POS_ID integer AUTO_INCREMENT PRIMARY KEY,
    POS_URL_FOTO varchar(255),
    FK_USUARIOS_USR_ID INTEGER
);

CREATE TABLE TICKETS (
    TIC_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    TIC_MENSAGEM TEXT NOT NULL,
    FK_USUARIOS_USR_ID INTEGER
);

CREATE TABLE TIPO_DENUNCIA (
    TIP_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
    TIP_NOME VARCHAR(100) NOT NULL
);

CREATE TABLE TOPICOS_TAGS (
    FK_TOPICOS_TOP_ID INTEGER,
    FK_TAGS_TAG_ID INTEGER,
    TOT_ID INTEGER AUTO_INCREMENT PRIMARY KEY
);

CREATE TABLE TICKETS_TIPOS_DENUNCIA (
    FK_TIPO_DENUNCIA_TIP_ID INTEGER,
    FK_TICKETS_TIC_ID INTEGER,
    TTD_ID INTEGER AUTO_INCREMENT PRIMARY KEY
);
 
ALTER TABLE TOPICOS ADD CONSTRAINT FK_TOPICOS_2
    FOREIGN KEY (FK_USUARIOS_USR_ID)
    REFERENCES USUARIOS (USR_ID)
    ON DELETE CASCADE;
 
ALTER TABLE TAGS ADD CONSTRAINT FK_TAGS_2
    FOREIGN KEY (FK_USUARIOS_USR_ID)
    REFERENCES USUARIOS (USR_ID)
    ON DELETE CASCADE;
 
ALTER TABLE POSTS ADD CONSTRAINT FK_POSTS_2
    FOREIGN KEY (FK_USUARIOS_USR_ID)
    REFERENCES USUARIOS (USR_ID)
    ON DELETE CASCADE;
 
ALTER TABLE TICKETS ADD CONSTRAINT FK_TICKETS_2
    FOREIGN KEY (FK_USUARIOS_USR_ID)
    REFERENCES USUARIOS (USR_ID)
    ON DELETE CASCADE;
 
ALTER TABLE TOPICOS_TAGS ADD CONSTRAINT FK_TOPICOS_TAGS_2
    FOREIGN KEY (FK_TOPICOS_TOP_ID)
    REFERENCES TOPICOS (TOP_ID)
    ON DELETE RESTRICT;
 
ALTER TABLE TOPICOS_TAGS ADD CONSTRAINT FK_TOPICOS_TAGS_3
    FOREIGN KEY (FK_TAGS_TAG_ID)
    REFERENCES TAGS (TAG_ID)
    ON DELETE RESTRICT;
 
ALTER TABLE TICKETS_TIPOS_DENUNCIA ADD CONSTRAINT FK_TICKETS_TIPOS_DENUNCIA_2
    FOREIGN KEY (FK_TIPO_DENUNCIA_TIP_ID)
    REFERENCES TIPO_DENUNCIA (TIP_ID)
    ON DELETE RESTRICT;
 
ALTER TABLE TICKETS_TIPOS_DENUNCIA ADD CONSTRAINT FK_TICKETS_TIPOS_DENUNCIA_3
    FOREIGN KEY (FK_TICKETS_TIC_ID)
    REFERENCES TICKETS (TIC_ID)
    ON DELETE SET NULL;